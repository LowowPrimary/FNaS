<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="theme-color" content="#000000" />

    <link rel="manifest" href="manifest.json" />

    <link rel="icon" type="image/png" href="./favicon/96x96.png" sizes="96x96" />
    <link rel="shortcut icon" href="./favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="./favicon/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="FNaS" />

    <title>Five Nights at Spuddy's</title>

    <style>
        body {
            background-color: black;
            overflow: hidden;
            font-family: "Pixel";
        }

        @font-face {
            font-family: "Pixel";
            src: url("pixel.ttf") format('truetype');
        }
        @font-face {
            font-family: "Title";
            src: url("consolas.ttf") format('truetype');
        }

        @keyframes coolShadeThingy { 
            0% {
                color: white;
            } 
            50% {
                color: gray;
            }
            100% { 
                color: white;
            } 
        }

        @keyframes shake {
            0% { translate: 1px, 1px; rotate: 0deg; }
            10% { translate: -1px, -2px; rotate: -1.5deg; }
            20% { translate: -3px, 0px; rotate: 1.5deg; }
            30% { translate: 3px, 2px; rotate: 0deg; }
            40% { translate: 1px, -1px; rotate: 1.5deg; }
            50% { translate: -1px, 2px; rotate: -1.5deg; }
            60% { translate: -3px, 1px; rotate: 0deg; }
            70% { translate: 3px, 1px; rotate: -1.5deg; }
            80% { translate: -1px, -1px; rotate: 1.5deg; }
            90% { translate: 1px, 2px; rotate: 0deg; }
            100% { translate: 1px, -2px; rotate: -1.5deg; }
        }

        @keyframes flashingRedDot {
            0% {opacity: 0;}
            50% {opacity: 100%;}
            100% {opacity: 0;}
        }

        .hallwayAnimatronicImage {
            position: absolute;
            top: 0;
            transform: translate(-50vw, 0);
            height: 105%;
            z-index: 1;
            pointer-events: none;
            filter: grayscale(.6) contrast(150%);
        }
        .animatronicImage {
            position: absolute;
            background-color: transparent;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            filter: grayscale(.9) contrast(175%);
            pointer-events: none;
        }

        #glowyEyes {
            display: none;
            position: absolute;
            top: 53%;
            left: 49%;
            width: 8%;
            /*transform: translate(" + mainRoomPosition + "vw, 0)*/
            transform: translate(-40vw, 0);
        }

        #mainMenu {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            font-size: 150%;
            z-index: 999;
            color: white;
        }

        
        #glowyText {
            position: absolute;
            
            top: 50%;
            left: 50%;
            width: 100%;
            transform: translate(-50%, -50%);
            animation: coolShadeThingy 4s ease-in-out infinite;
            text-align: center;
            transition-duration: 1s;
        }
        #glowyText > p {
            margin: 0;
        }

        #nightSelection {
            display: none;
            opacity: 0;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            flex-direction: column;
            justify-content: center;
            align-content: center;
            transition-duration: 1s;
        }
        .nightSelectionBtn {
            margin-left: .5%;
            margin-right: .5%;
            width: 10%;
            height: 100%;
            padding-top: 17px;
            padding-left: 10px;
            border: 3px solid gray;
            background-color: black;
            color: white;
            transition-duration: .4s;
            font-family: "Pixel";
        }
        .nightSelectionBtnActive:hover {
            border: 5px solid white;
            transform: scale(110%);
        }

        #extraNightSelection {
            width: 100%;
            height: 10%;
            margin-top: 2%;
            display: flex;
            flex-direction: row;
            justify-content: center;
            display: none;
        }
        #normalNightSelection {
            width: 100%;
            height: 10%;
            display: flex;
            flex-direction: row;
            justify-content: center;
        }
        #gameOverScreen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            z-index: 1001;
            color: white;
            transition-duration: 2s;
        }
        
        #victoryScreen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            color: white;
            opacity: 0;
            z-index: 1000;
            transition-duration: 4s;
        }

        #startScreen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            color: white;
            z-index: 999;
            transition-duration: 1s;
        }

        #canvasOverlay {
            z-index: 1000;
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        /*
        @keyframes openCamera {
            0% {
                transform: perspective(400px) rotateX(0deg);
            }
            100% {
                transform: perspective(400px) rotateX(90deg);
            }
        }
        */
        #fps {
            position: absolute;
            top: 1%;
            left: 3%;
            color: white;
            z-index: 100;
        }
        #mainGame {
            display: none;
            position: absolute;
            top: 0;
            width: 150%;
            height: 100%;
            transform: translate(-50vw, 0);
            z-index: 0;
            transition-duration: 1s;
        }
        #mainRoom {
            position: absolute;
            top: 0;
            left: 50%;
            width: 100%;
            height: 100%;
            transform: translate(-50vw, 0);
            z-index: 3;
        }
        #fan {
            position: absolute;
            top: 5%;
            left: 52%;
            height: 100%;
            width: 100%;
            transform: translate(-50vw, 0);
            z-index: 100;
        }
        /*
        #fan {
            position: absolute;
            top: 65%;
            left: 85%;
            width: 10%;
            transform: translate(-50vw, 0);
            z-index: 4;
        }
        */
        #hallways {
            transition-duration: 100ms;
            position: absolute;
            top: 0;
            left: 50%;
            height: 100%;
            width: 100%;
            transform: translate(-50vw, 0);
            z-index: -10;
            display: none;
            filter: grayscale(.6) contrast(150%);
        }
        #camera {
            display: flex;
            position: absolute;
            transform-origin: bottom;
            transform: perspective(400px) rotateX(90deg);
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgb(85, 85, 85);
            transition-duration: .3s;
            z-index: 10;
        }
        #cameraOverlay {
            position: absolute;
            top: 2%;
            left: 2%;
            width: 96%;
            height: 96%;
            outline: 3px solid white;
            z-index: 1000;
        }
        #cameras {
            position: absolute;
            right: 4%;
            bottom: 3%;
            width: 30%;
            height: 60%;
            z-index: 10000;
        }
        #map {
            position: absolute;
            z-index: 1;
            right: 4%;
            bottom: 3%;
            width: 30%;
            height: 60%;
        }
        
        .camButton {
            text-align: center;
            position: absolute;
            width: 12%;
            height: 8%;
            border: 2px solid white;
            background-color: rgb(108, 108, 108);
            color: white;
            font-weight: 900;
            font-family: "Pixel";
            transition-duration: .2s;
        }
        .camButton:hover {
            background-color: rgb(90, 90, 90);
            transform: scale(110%);
        }

        .camButton:active {
            background-color: rgb(60, 60, 60);
        }

        .controlButtons {
            border-radius: 5%;
            border: 2px solid gray;
            width: 5%;
            aspect-ratio: 1;
            position: absolute;
            z-index: 3;
            transform: translate(-50vw, 0);
            background-color: rgb(133, 133, 133);
        }

        .controlButtons:hover {
            background-color: rgb(113, 113, 113);
        }
        
        #topRight {
            display: flex;
            color: white;
            z-index: 100;
            display: flex;
            flex-direction: column;
            position: absolute;
            top: 2%;
            right: 3%;
            justify-content: center;
            height: 20%;
            width: 11%;
            margin: 0;
        }
        #Time {
            position: absolute;
            top: 0;
            right: 0;
            font-size: 250%;
            margin: 0;
        }
        #Night {
            position: absolute;
            top: 40%; right: 0;
            margin: 0;
        }
        #bottomLeft {
            display: flex;
            color: white;
            z-index: 100;
            display: flex;
            flex-direction: column;
            position: absolute;
            bottom: 2%;
            left: 3%;
        }
        #bottomLeft > * {
            margin: 0;
        }

        #static {
            display: flex;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 10%;
            transition-duration: .1s;
            z-index: 100;
        }
        #flippyRunAnimation {
            display: flex;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #titleScreenStatic {
            display: flex;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 20%;
            z-index: 100;
            pointer-events: none;
        }

        #currentCameraImage {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            filter: grayscale(.8) contrast(120%);
        }

        #batteryImage {
            display: flex;
            flex-direction: row;
            position: absolute;
            right: -40%;
            height: 60%;
            width: 90%;
            border: 4px solid white;
        }
        .batterySection {
            height: 96%;
            width: 18%;
            margin: 1%;
        }
            

        #RealMenu {
            display: none;
            transition-duration: 1s;
        }
        #title {
            /* REMOVE */
            display: block;
            position: absolute;
            text-align: center;
            transition-duration: 1s;
            font-size: 200%;
            /*
            left: 50%;
            top: 20%;
            transform: translate(-50%, 0);
            */
            font-family: "Title";
            width: 1%;
            left: 10%;
        }
        #titleScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition-duration: 1s;
        }
        #newGameConfirmation {
            position: absolute;
            z-index: 1000;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: translate(0, -100%);
            background-color: black;
            opacity: 80%;
            transition-duration: 1s;
            font-size: 180%;
            text-align: center;
            display: none;
            flex-direction: column;
        }
        #newGameBackBtn {
            margin-bottom: 2%;
            background: none;
            border: 5px solid white;
            font-size: 200%;
            font-family: "Pixel";
            width: 40%;
            height: 18%;
            align-self: center;
            border-radius: 20px;
            color: white;
            transition-duration: 1s;
        }
        #newGameBackBtn:hover {
            transform: scale(110%);
        }

        #newGameConfirmationBtn {
            background: none;
            border: 5px solid red;
            font-size: 200%;
            font-family: "Pixel";
            width: 40%;
            height: 18%;
            align-self: center;
            border-radius: 20px;
            color: red;
            transition-duration: 1s;
        }
        #newGameConfirmationBtn:hover {
            transform: scale(110%);
        }

        .menuButton {
            background-color: transparent;
            color: white;
            border: 5px solid white;
            border-radius: 10px;
            transition-duration: .5s;
            height: 7%;
            font-size: 150%;
            transform: translate(-50%, 0);
            font-family: "Pixel";
        }
        .menuButton:hover {
            transform: translate(-50%, 0) scale(110%);
        }
        #startBtn {
            position: absolute;
            top: 50%;
            transition-duration: .5s;
            border: none;
            font-family: "Title";
            left: 18%;
        }
        #newGameBtn {
            position: absolute;
            top: 58%;
            transition-duration: .5s;
            border: none;
            font-family: "Title";
            left: 18%;
        }
        #startBtn:hover ~ #dash { 
            top: 50%;
            left: 7%;
            display: block;
        }
        #newGameBtn:hover + #dash { 
            top: 58%;
            left: 7%;
            display: block;
        }
        #dash {
            font-family: "Title";
            pointer-events: none;
            color: white;
            background: none;
            position: absolute;
            border: none;
            display: none;
            font-size: 200%;
        }

        .jumpscare {
            display: flex;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10000;
        }

        #cutscene {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: scale(100%);
            z-index: 1001;
            opacity: 0;
            transition-duration: 5s;
        }

        #agroSelection {
            display: none;
            width: 100%;
            flex-direction: row;
            justify-content: center;
            text-align: center;
        }
        .agroSelectionBtn {
            overflow: visible;
            color: white;
            background-color: transparent;
            border: none;
            margin-left: 5%;
            margin-right: 5%;
            font-family: "Pixel";
            font-size: 100%;
            transition-duration: .3s;
        }
        .agroSelectionBtn:hover {
            transform: scale(110%);
        }
        .nextBtn {
            display: flex;
            position: absolute;
            top: 83%;
            left: 80%;
            transition-duration: 1s;
            width: 9%;
            height: 5%;
            background-color: rgb(96, 96, 96);
            align-self: center;
            color: white;
            font-size: 120%;
        }
        .nextBtn:hover {
            transform: scale(110%);
        }
        .agroSelectionDiv {
            margin: 0;
            width: 20%;
            display: flex;
            flex-direction: column;
        }
        .profilePic {
            margin: 0;
            overflow: hidden;
            width: 60%;
            aspect-ratio: 1;
            display: flex;
            align-self: center;
            overflow: hidden;
        }

        .nightSelectionBtnDiv {
            display: flex;
            flex-direction: row;
            justify-content: center;
        }

        .doors {
            position: absolute;
            top: -47%;
            left: 50%;
            height: 105%;
            width: 100%;
            transform: translate(-50vw, 0);
            transition: .3s;
            z-index: 2;
        }
    </style>

</head>
<body>

    <img id="glowyEyes" src="./KingSpudEyes.png">

    <div id="mainMenu">
        <!--
        <p id="glowyText"><span style="position: absolute; top: -180%; width: 200%; left: 50%; transform: translate(-50%, 0); text-align: center; font-size: 110%;"><span style="color: red;">
            WARNING: This game contains flashing lights and loud audio.
        </span></span>
        <span>
        Press any key to continue...
        </span></p>
        -->
        <div id="glowyText">
            <p style="color: red; font-size: 130%;">WARNING: This game contains flashing lights and loud audio.</p>
            <p>Press any key to continue...</p>
        </div>
        <div id="RealMenu">
            <!--
            <p id="title">Five Nights at <span style="color: rgb(147, 106, 81); font-size: 150%;">Spuddy's</span></p>
            -->
            <div id="titleScreen">
                <p id="title">Five Nights at Spuddy's</p>
                <button id="startBtn" class="menuButton">Continue</button>
                <button id="newGameBtn" class="menuButton">New Game</button>
                <button disabled id="dash">>></button>

                <div id="newGameConfirmation">
                    <p>Are you sure you want to reset your game data? (CANNOT UNDO)</p>
                    <button id="newGameBackBtn">Back</button>
                    <button id="newGameConfirmationBtn">Reset</button>
                </div>

                <img src="./Animatronics/Titlescreen.png" style="z-index: -1; position: absolute; right: 0; top: 0; height: 100%;">
                <canvas id="titleScreenStatic"></canvas>
                <p style="position: absolute; right: 0; bottom: 0; font-size: 70%; font-family: 'Title'">Version 1.0</p>
            </div>
            <!--
            <img src="./KingSpudForLogo.png" style="opacity: 50%; position: absolute; right: 0; top: 0; height: 80%; filter: grayscale(.8); display: none;">
            -->

            <div id="nightSelection">
                <div id="normalNightSelection"></div>
                <div id="extraNightSelection"></div>
                <div id="agroSelection">
                    <p style="position: absolute; top: 5%; left: 50%; transform: translate(-50%, 0); font-size: 120%;">Customize Night</p>
                    <p style="position: absolute; top: 80%; left: 40%; transform: translate(-50%, 0); width: 100%;">(0-2)easy  (3-6)med  (7-12)hard  (12+)extreme</p>
                </div>
            </div>
        </div>
    </div>

    <div id="gameOverScreen">
        <p style="position: absolute; top: 30%; left: 50%; transform: translate(-50%, -50%); font-size: 450%;">Game Over</p>
        <p id="gameOverGotBy" style="position: absolute; top: 44%; left: 50%; transform: translate(-50%, -50%);">Got by: ____</p>
        <button id="gameOverContinueButton" style="position: absolute; top: 55%; left: 50%;" class="menuButton">Continue</button>
        <button id="gameOverMainMenuButton" style="position: absolute; top: 65%; left: 50%;" class="menuButton">Main Menu</button>
    </div>

    <div id="startScreen">
        <p style="position: absolute; top: 38%; left: 50%; transform: translate(-50%, -50%); font-size: 350%; font-weight: bolder;">12:00 AM</p>
        <p id="startScreenNight" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 350%; font-weight: bolder;">1st Night</p>
    </div>

    <div id="victoryScreen">
        <p id="AMTransition" style="transition-duration: 1s; position: absolute; top: 42%; left: 45%; transform: translate(-50%, -50%); font-size: 450%;">5</p>
        <p style="position: absolute; top: 42%; left: 55%; transform: translate(-50%, -50%); font-size: 450%;">AM</p>
    </div>

    <audio id="menuMusic" src="./SFX/Other/fnafsong.mp3"></audio>
    <audio loop id="menuMusic2" src="./SFX/Ambience/menumusic.ogg"></audio>
    <audio id="jumpscareAudio" src="./SFX/Animatronics/jumpscare.mp3"></audio>
    <audio id="gameOverMusic" src="./SFX/Other/horhorhorhorhorhorhorhorhorhor.mp3"></audio>
    <audio loop id="jukebox" src="./SFX/Animatronics/jukebox.mp3"></audio>
    <audio loop id="fanAudio" src="./SFX/Ambience/fan.wav"></audio>
    <audio loop id="kitchenAudio" src="./SFX/Animatronics/kitchenrattling.wav"></audio>
    <audio loop id="gameplayMusic" src="./SFX/Ambience/gameplayMusic.wav"></audio>
    <audio loop id="lightsOn" src="./SFX/Player/lightson.ogg"></audio>

    <p style="display: none; background-color: white; z-index: 10000000; position: absolute; top: 0; left: 0;" id="info">AHHH</p>

    <div id="mainGame">
        <img id="hallways" src="./hallways.png">
        <img id="mainRoom" src="./classroom.png">
        <img id="fan" src="./fan.png">
        <img class="doors" src="./DoorLeft.png">
        <img class="doors" src="./DoorRight.png">
        <!--
        <img id="fan" src="./Ex/fan.webp">
        -->
        <!--
        <video autoplay loop muted>
            <source src="./" type="video/mp4" />
        </video>
        -->

    </div>

    <div id="topRight">
        <p id="Time">12 AM</p>
        <p id="Night">Night 1</p>
    </div>
    <div id="bottomLeft">
        <p>Power left: <span id="PowerLevel" style="font-size: 150%;">100%</span></p>
        <div style="display: flex; flex-direction: row;">
            <p>Usage: </p>
            <div id="batteryImage"></div>
        </div>
    </div>

    <div id="camera">

        <img src="./Cameras/C6.png" id="currentCameraImage">
        <canvas id="flippyRunAnimation"></canvas>
        <canvas id="static"></canvas>

        <div id="cameraOverlay">
            <div style="position: absolute; top: 5%; left: 3%; background-color: red; border-radius: 50%; width: 4%; aspect-ratio: 1; animation: flashingRedDot 3s steps(1, end) infinite;"></div>
        </div>

        <img id="map" src="./Map.png">
        <div id="cameras">
            <button class="camButton" style="left: 55%; top: 40%;">C7</button>
            <button class="camButton" style="left: 25%; top: 5%;">C6</button>
            <button class="camButton" style="left: 73%; top: 5%;">C5</button>
            <button class="camButton" style="left: 74%; top: 27%;">C4B</button>
            <button class="camButton" style="left: 45%; top: 27%;">C4A</button>
            <button class="camButton" style="left: 55%; top: 80%;">C1A</button>
            <button class="camButton" style="left: 55%; top: 92%;">C1B</button>
            <button class="camButton" style="left: 90%; top: 80%;">C2</button>
            <button class="camButton" style="left: 30%; top: 50%;">C3B</button>
            <button class="camButton" style="left: 30%; top: 77%;">C3A</button>
        </div>
    </div>

    <img id="cutscene" src="./Cutscenes/IntroCutscene.png">

    <p id="fps">FPS: 0</p>

    <canvas id="canvasOverlay"></canvas>

    <script>
        try {
        let gameStarted = false;
        let currentNight = 0;
        let nightPlaying;

        const hallways = document.getElementById("hallways");

        let cheatsEnabled = true;

        let powerOut = false;

        const fanAudio = document.getElementById("fanAudio");
        fanAudio.volume = .15;//.07;

        let allTimeouts = {
            "KingSpud": null,
            "Sampler": null,
            "PairProgrammers": null,
            "FlippyDoo": null
        };

        const cutsceneImages = {
            4: "./Cutscenes/Paycheck.png",
            5: "./Cutscenes/PaycheckExtra.png",
            6: "./Cutscenes/Fired.png"
        };
        let currentAddHourTimeout;
        let currentUpdateFPSTimeout;
        let randomSoundsTimeout;

        let flippyCharging = false;
        let flippyChargeTimeout;

        const gameplayMusic = document.getElementById("gameplayMusic");
        
        const RealMenu = document.getElementById("RealMenu");
        const startBtn = document.getElementById("startBtn");
        const titleScreen = document.getElementById("titleScreen");
        const title = document.getElementById("title");

        const mainMenu = document.getElementById("mainMenu");
        const glowyText = document.getElementById("glowyText");
        const menuMusic = document.getElementById("menuMusic");
        const menuMusic2 = document.getElementById("menuMusic2");
        let introAnimationStarted = false;
        mainMenu.style.display = "flex";
        RealMenu.style.opacity = "100%";


        let currentNightP = document.getElementById("Night");
        if (localStorage.getItem("currentNight")) {
            currentNight = localStorage.getItem("currentNight");
        } else {
            currentNight = 0;
            localStorage.setItem("currentNight", 0);
        }
        currentNightP.textContent = "Night " + (parseInt(currentNight)+1);
        //alert(localStorage.getItem("currentNight"));
        
        let nightSelectionButtons = [];
        let customAgro = [];
        const cutscene = document.getElementById("cutscene");
        const nightSelection = document.getElementById("nightSelection");
        const normalNightSelection = document.getElementById("normalNightSelection");
        const extraNightSelection = document.getElementById("extraNightSelection");
        const agroSelection = document.getElementById("agroSelection");

        
        function updateNight(newNight) {
            if (currentNight <= newNight) {
                currentNight = newNight;

                localStorage.setItem("currentNight", newNight);
                for (let i=0; i<nightSelectionButtons.length; i++) {
                    if (i <= currentNight) {
                        nightSelectionButtons[i].disabled = false;
                        nightSelectionButtons[i].classList.add("nightSelectionBtnActive");
                        nightSelectionButtons[i].style.fontSize = "100%";
                        nightSelectionButtons[i].style.cursor = "pointer";
                        nightSelectionButtons[i].style.color = "";
                        nightSelectionButtons[i].style.border = "";
                    } else {
                        nightSelectionButtons[i].style.border = "black";
                        nightSelectionButtons[i].style.color = "gray";
                        nightSelectionButtons[i].disabled = true;
                        nightSelectionButtons[i].fontSize = "";
                        nightSelectionButtons[i].style.cursor = "";
                        nightSelectionButtons[i].classList.remove("nightSelectionBtnActive");
                    }
                }
                if (currentNight > 4) {
                    extraNightSelection.style.display = "flex";
                }
            }
        }
        for (let i=0; i<7; i++) {
            let btn = document.createElement("button");
            btn.classList.add("nightSelectionBtn");
            btn.textContent = ("Night " + (i+1));
            if (i > currentNight) {
                btn.style.border = "black";
                btn.style.color = "gray";
                btn.disabled = true;
            } else {
                btn.classList.add("nightSelectionBtnActive");
                btn.style.fontSize = "100%";
                btn.style.cursor = "pointer";
            }
            btn.addEventListener("click", async function() {
                if (!menuMusic2.paused) {
                    menuMusic2.pause();
                }
                nightPlaying = i;
                if (nightPlaying == 6) {
                    agroLevelsPs = [];
                    for (let name in entities) {
                        let div = document.createElement("div");
                        div.classList.add("agroSelectionDiv");
                        let animName = document.createElement("p");
                        animName.textContent = name;
                        div.appendChild(animName);
                        let img = document.createElement("img");
                        img.src = "./Animatronics/" + name + "/Profile.png";
                        //img.src = "./KingSpudForLogo.png";
                        img.classList.add("profilePic");
                        div.appendChild(img);
                        let p = document.createElement("p");
                        p.style.width = "10%";
                        p.textContent = "0";
                        p.style.margin = 0;

                        let agroLevel = 0;
                        agroLevelsPs.push(p);

                        let btnDiv = document.createElement("div");
                        btnDiv.classList.add("nightSelectionBtnDiv");

                        for (let i=0; i<3; i+=2) {
                            let btn = document.createElement("button");
                            btn.classList.add("agroSelectionBtn");                            
                            
                            btn.textContent = ["<", null, ">"][i];
                            btn.addEventListener("click", function() {
                                if ((agroLevel+(i-1)) > -1 && (agroLevel+(i-1)) < 21) {
                                    agroLevel += (i-1);
                                    p.textContent = agroLevel;
                                }
                            });
                            if (i == 2) {
                                btnDiv.appendChild(p);
                            }
                            btnDiv.appendChild(btn);
                        }

                        let aiLevelP = document.createElement("p");
                        aiLevelP.textContent = "A.I. Level";
                        div.appendChild(aiLevelP);
                        
                        div.appendChild(btnDiv);
                        agroSelection.appendChild(div);
                        normalNightSelection.style.display = "none";
                        extraNightSelection.style.display = "none";
                        agroSelection.style.display = "flex";
                    }

                    let nextBtn = document.createElement("button");
                    nextBtn.textContent = "READY";
                    nextBtn.classList.add("nextBtn");
                    nextBtn.addEventListener("click", function() {
                        agroSelection.style.display = "none";
                        for (let i=0; i<agroLevelsPs.length; i++) {
                            customAgro.push(agroLevelsPs[i].textContent);
                        }

                        RealMenu.style.opacity = "0";
                        setTimeout(function () {
                            nightSelection.style.display = "none";
                            /*
                            startBtn.style.display = "flex";
                            title.style.display = "flex";
                            */
                            //titleScreen.style.display = "flex";

                            startGame();
                        }, 3000);

                    });
                    agroSelection.appendChild(nextBtn);

                    agroSelection.style.display = true;
                    return;
                }

                RealMenu.style.opacity = "0";
                setTimeout(function() {
                    nightSelection.style.display = "none";
                    /*
                    startBtn.style.display = "flex";
                    title.style.display = "flex";
                    */
                    //titleScreen.style.display = "flex";
                    if (nightPlaying == 0) {
                        // INTRO CUTSCENE
                        cutscene.src = "./Cutscenes/IntroCutscene.png";
                        cutscene.style.display = "block";
                        cutscene.style.transform = "scale(100%)";
                        setTimeout(function() {
                            cutscene.style.opacity = "100%";
                            cutscene.style.transform = "scale(110%)";
                        }, 50);
                        setTimeout(function() {
                            cutscene.style.opacity = 0;
                            setTimeout(function() {
                                cutscene.style.display = "none";
                                startGame();
                            }, 5000);
                        }, 11500);
                    } else {
                        startGame();
                    }
                }, 3000);
            });
            nightSelectionButtons.push(btn);
            if (i<5) {
                normalNightSelection.appendChild(btn);
            } else {
                extraNightSelection.appendChild(btn);
            }
        }
        
        // NIGHTS 6 AND 7
        if (currentNight > 4) {
            extraNightSelection.style.display = "flex";
        }
        
        const fps = document.getElementById("fps");

        const camera = document.getElementById("camera");
        let cameraOnScreen = false;
        const cameras = document.getElementById("cameras").querySelectorAll("button");
        let currentCameraNum = "C6";

        const mainRoom = document.getElementById("mainRoom");
        let mainRoomPosition = -50;
        let moved = false;

        const info = document.getElementById("info");
        info.textContent = "AH";
        info.style.backgroundColor = "white";

        const mainGame = document.getElementById("mainGame");
        let screenWidth = window.innerWidth;
        let screenOffsetX = screenWidth / 10;
        let screenHeight = window.innerHeight;
        let screenOffsetY = screenWidth / 15;

        // -34 & -70 ARE IN VW
        // higher |number|, lower view
        const lowerBound = -34;
        // higher |number|, higher view
        const upperBound = -70;

        const canvasOverlay = document.getElementById("canvasOverlay");
        const canvasOverlayCTX = canvasOverlay.getContext("2d");


        //AGRO & LOCATION GETS MODIFIED DEPENDING ON NIGHT
        const entities = {
            "Sampler": {
                "Name": "Sampler",
                "StartLocation": "C6",
                "Location": "C6",
                "Agro": 20,
                "MoveTime": 4.97,
                "Attack": "Wait"
            },
            "PairProgrammers": {
                "Name": "PairProgrammers",
                "StartLocation": "C6",
                "Location": "C6",
                "Agro": 1,
                "MoveTime": 4.98,
                "Attack": "Wait"
            },
            "KingSpud": {
                "Name": "KingSpud",
                "StartLocation": "C6",
                "Location": "C6",
                "Agro": 1,
                "MoveTime": 3.02,
                "Attack": "SetPath",
            },
            "FlippyDoo": {
                "Name": "FlippyDoo",
                "StartLocation": "C4A",
                "Location": "C4A",
                "Agro": 0,
                "MoveTime": 5.01,
                "Attack": "Instant",
                "CurrentStage": 0,
            }
        }

        const batteryImage = document.getElementById("batteryImage");
        let battery = 100.00;
        const powerLevel = document.getElementById("PowerLevel");


        let passiveDrainInterval;
        function passiveDrain() {
            battery -= .1;
        }
        
        const batteries = [];
        let batteryUsage = 1;
        function updateBatteryLoss(gain) {
            batteryUsage += gain;
            for (let i=0; i<batteries.length; i++) {
                if (i < batteryUsage) {
                    batteries[i].style.display = "block";
                } else {
                    batteries[i].style.display = "none";
                }
            }
        }

        //let colors = ["gray", "gray", "gray", "gray", "gray"];
        const colors = ["green", "green", "orange", "red", "red"];
        for (let i=0; i<5; i++) {
            let div = document.createElement("div");
            div.classList.add("batterySection");
            div.style.backgroundColor = colors[i];
            div.style.display = "none";
    
            let subDiv = document.createElement("div");
            subDiv.style.height = "100%";
            subDiv.style.width = "35%";
            subDiv.style.backgroundColor = "dark" + colors[i];

            div.appendChild(subDiv);
            batteries.push(div);
            batteryImage.appendChild(div);
        };
        updateBatteryLoss(0);

        /*
        let agroStage = 0;
        let agroTime = 60/Entity["Agro"];
        function increaseFlippyAgro() {
            agroStage++;
            CHANGEIMG
        };
        let curFlippyTimeout = setTimeout(increaseFlippyAgro, agroTime);
        if (currentCameraNum == covenum) {
            clearTimeout(curFlippyTimeout);
        }
        */

        let drawingFlashingBars = false;

        const static = document.getElementById("static");
        static.width = screenWidth;
        static.height = screenHeight;
        const staticCTX = static.getContext("2d");
        staticCTX.fillStyle = "black";
        const staticRows = 19;//25;
        const staticColumns = 60;//80;

        let rowSize = screenWidth/staticRows;
        let columnSize = screenHeight/staticColumns;
        

        function generatePerlinNoise(width, height, scale) {
            const noise = [];
            for (let y=0; y<width; y++) {
                noise[y] = [];
                for (let x=0; x<height; x++) {
                    noise[y][x] = Math.random() * scale;
                }
            }
            return noise;
        }


        let curStaticIteration = 0;
        //let staticProgressBar = 0;

        const statics = [];
        function newStatics() {
            for (let i=0; i<10; i++) {
                const noise = generatePerlinNoise(staticColumns, staticRows, 1);
                statics[i] = noise;
            }
        }
        newStatics();

        const titleScreenStatic = document.getElementById("titleScreenStatic");
        titleScreenStatic.width = screenWidth;
        titleScreenStatic.height = screenHeight;
        const tsCTX = titleScreenStatic.getContext("2d");
        let drawingTSStatic = true;

        function drawTitleScreenStatic() {
            if (drawingTSStatic) {
                const noise = statics[curStaticIteration];
                curStaticIteration++;
                if (curStaticIteration > 9) {curStaticIteration = 0;}

                tsCTX.fillStyle = "black";
                tsCTX.fillRect(0, 0, screenWidth, screenHeight);
                for (let y=0; y<noise.length; y++) {
                    for (let x=0; x<noise[y].length; x++) {
                        tsCTX.fillStyle = `rgba(255, 255, 255, ${noise[y][x]})`;
                        tsCTX.fillRect(x*rowSize, y*columnSize, rowSize, columnSize);
                    }
                }
                setTimeout(drawTitleScreenStatic, 400);
            }
        }
        drawTitleScreenStatic();


        function drawStatic() {
            //const noise = generatePerlinNoise(staticColumns, staticRows, 1);
            staticCTX.fillStyle = "black";
            staticCTX.fillRect(0, 0, screenWidth, screenHeight);
            

            if (drawingFlashingBars) {
                staticCTX.fillStyle = "white";
                staticCTX.fillRect(0, Math.floor(Math.random()*screenHeight), screenWidth, 50);
                staticCTX.fillRect(0, Math.floor(Math.random()*screenHeight), screenWidth, 50);
            } else {
                const noise = statics[curStaticIteration];
                curStaticIteration++;
                if (curStaticIteration > 9) {curStaticIteration = 0;}

                for (let y=0; y<noise.length; y++) {
                    for (let x=0; x<noise[y].length; x++) {
                        staticCTX.fillStyle = `rgba(255, 255, 255, ${noise[y][x]})`;
                        staticCTX.fillRect(x*rowSize, y*columnSize, rowSize, columnSize);
                    }
                }
            }
        }
        drawStatic();

        const garbleAudio = ["garble1.wav", "garble2.wav", "garble3.wav"];
        function increaseStatic(opacity, duration, intensity, flashBars=false) {
            static.style.opacity = opacity;
            staticDuration = intensity;
            if (flashBars) {
                playAudio(garbleAudio[Math.floor(Math.random()*garbleAudio.length)]);
                drawingFlashingBars = true;
                drawStatic();
            }
            setTimeout(function() {
                if (flashBars) {
                    drawingFlashingBars = false;
                }
                static.style.transition = "none";
                static.style.opacity = "10%";
                static.style.transition = "";
                cameraSwitching = false;
                staticDuration = 10;
            }, duration);
        }

        let iteration = 0;
        let staticDuration = 10;
        let fpsCount = 0;
        let lastBattery = battery;
        let currentFramerate = 60;
        
        const jukebox = document.getElementById("jukebox");
        const glowyEyes = document.getElementById("glowyEyes");
        let flickTime = 0;
        let nextFlick = 30;
        let flickering = false;
        let eyesVisible = false;

        let lightFlicker = 0;
        let nextLightFlick = 30;
        let lightVisible = false;

        let drawingFlippyRun = false;
        let flippyRunIteration = 0;
        
        const flippyRunCanvas = document.getElementById("flippyRunAnimation");
        flippyRunCanvas.width = screenWidth;
        flippyRunCanvas.height = screenHeight;
        const flippyRunCTX = flippyRunCanvas.getContext("2d");

        function tick() {
            if (cameraOnScreen) {
                if (iteration > staticDuration) {
                    drawStatic();
                    iteration = 0;
                }
                iteration++;
            }
            
            if (drawingFlippyRun) {
                flippyRunCTX.clearRect(0, 0, screenWidth, screenHeight);
                flippyRunCTX.drawImage(jumpscareImages["FlippyRun"][flippyRunIteration], 0, 0, screenWidth, screenHeight);

                flippyRunIteration++;
                if (flippyRunIteration > 23) {
                    flippyRunIteration = 0;
                    drawingFlippyRun = false;
                    flippyRunCTX.clearRect(0, 0, screenWidth, screenHeight);
                }
            } /*else {
                flippyRunCTX.clearRect(0, 0, screenWidth, screenHeight);
                flippyRunCTX.fillStyle = `rgba(200, 200, 200, .3)`;
                flippyRunCTX.fillRect(0, staticProgressBar, screenWidth, 30);
                staticProgressBar += 1;
                if (staticProgressBar > screenHeight) {staticProgressBar = 0;}
            }*/
            

            if (battery <= 0) {
                if (!powerOut) {
                    // POWER OUT
                    cancelAllAudio();
                    playAudio("powerdown.wav");
                    camera.style.transform = "perspective(1000px) rotateX(90deg)";
                    mainRoom.style.filter = "grayscale(1) contrast(150%)";
                    // could combine this and the bottom but eh
                    hallways.style.display = "none";


                    /*
                    // REPLACED WITH resetButtons()
                    ctrlBtns.forEach(a => {
                        if (a.style.backgroundColor == "green") {
                            a.style.backgroundColor = "red";
                        } else if (a.style.backgroundColor == "rgb(183, 183, 183)") {
                            a.style.backgroundColor = "rgb(133, 133, 133)";
                        }
                    });
                    */


                    powerOut = true;


                    fan.src = "./staticfan.png";
                    for (let i=0; i<Object.values(allTimeouts).length; i++) {
                        clearTimeout(Object.values(allTimeouts)[i]);
                    } 

                    resetButtons();

                    // make powerUsage be 0
                    updateBatteryLoss(-1);

                    cameraOnScreen = false;
                    moved = false;

                    if (!fanAudio.paused) {
                        fanAudio.pause();
                    }
                    if (!gameplayMusic.paused) {
                        gameplayMusic.pause();
                    }
                    if (nightPlaying > 0) {
                        clearInterval(passiveDrainInterval);
                    }
                    if (flippysSongId) {
                        clearInterval(flippysSongId);
                    }
                    let attemptNum = 0;
                    
                    setTimeout(function() {
                        playAudio("deep steps.wav");
                    }, 4000);
                    function attemptPhase2() {
                        if (!gameStarted) {return};
                        attemptNum++;
                        if (Math.floor(Math.random() * 5) == 1 || attemptNum == 5) {
                            try {
                            glowyEyes.style.transform = "translate(" + mainRoomPosition + "vw, 0)"
                            glowyEyes.style.display = "block";
                            flickering = true;
                            jukebox.play();
                            attemptNum = 0;
                            function attemptPhase3() {
                                if (!gameStarted) {return};
                                attemptNum++;
                                if (Math.floor(Math.random() * 5) == 1 || attemptNum == 5) {
                                    if (!jukebox.paused) {
                                        jukebox.pause();
                                    }

                                    setTimeout(function() {mainGame.style.opacity = 0;}, 2000);
                                    glowyEyes.style.display = "none";
                                    flickering = false;
                                    function attemptJumpscare() {
                                        if (!gameStarted) {return};
                                        attemptNum++;
                                        if (Math.floor(Math.random() * 2) == 1 || attemptNum == 10) {
                                            jumpscare("KingSpud");
                                        } else {
                                            setTimeout(attemptJumpscare, 2000);
                                        }
                                    }
                                    attemptNum = 0;
                                    setTimeout(attemptJumpscare, 2000);
                                } else {
                                    setTimeout(attemptPhase3, 5000);
                                }
                            }
                            setTimeout(attemptPhase3, 5000);
                            } catch(er) {
                                alert(er);
                            }

                        } else {
                            setTimeout(attemptPhase2, 5000);
                        };
                    }
                    setTimeout(attemptPhase2, 5000);
                }
                if (flickering) {
                    flickTime++;
                    if (flickTime >= nextFlick) {
                        if (eyesVisible) {
                            glowyEyes.style.display =  "none";
                            eyesVisible = false;
                        } else {
                            glowyEyes.style.display = "block";
                            eyesVisible = true;
                        }
                        flickTime = 0;
                        nextFlick = Math.floor(Math.random()*10);
                    }; 
                }
            } else {
                // BATTERY: 1% every 9.6 seconds, cut in half for lights, door, and monitor each
                /*
                9.6 seconds per battery, time halfed for every bar used
                f(x) = 19.2/(2^x) -> seconds per battery

                x = 19.2/(2^y)
                (2^y)(x)=19.2

                log2(2^y) = log2(19.2 / x)

                y = log2(19.2 / x) -> battery per second (base 2)
                y= log(19.2/x)) / log(2) -> battery per second (base 10)

                */

                if (isLightOn[0] || isLightOn[1]) {
                    lightFlicker++;
                    if (lightFlicker >= nextLightFlick) {
                        if (lightVisible) {
                            //hallways.style.display =  "none";
                            hallways.style.opacity = Math.floor(Math.random()*100) + "%";
                            lightVisible = false;
                        } else {
                            //hallways.style.display = "block";
                            hallways.style.opacity = "100%";
                            lightVisible = true;
                        }
                        lightFlicker = 0;
                        nextLightFlick = Math.floor(Math.random()*10); //+ (60*Math.floor(Math.random()*2) * Math.floor(Math.random()*2));
                    }; 
                }

                battery -= (1 / (19.2 / (2 ** batteryUsage))) / currentFramerate; //(Math.log2((19.2/batteryUsage)))/currentFramerate;//(Math.log(19.2/batteryUsage) / Math.log(2))/currentFramerate;
                
                if (Math.ceil(battery) != lastBattery) {
                    powerLevel.textContent = Math.ceil(battery) + "%";
                    lastBattery = battery;
                }
            }

                /*
-- IN TICK FNC

-- ON TIME JS;
eyesVisible = false;
nextFlick = 0;
glowyEyes.style.display = "done";

-- easter egg
        glowyEyes.addEventListener("click", function() {playAudio("honk.mp3");});

                */

                /*
                setTimeout(function() {
                    jumpscare("KingSpud");
                }, 5+(Math.floor(Math.random() * 90)*1000));
                return;
            }
            */
            fpsCount++;
            if (gameStarted) {
                window.requestAnimationFrame(tick);
                //setTimeout(tick, 16.6);
            }
        }

        

        function updateFPS() {
            currentFramerate = fpsCount;
            fps.textContent = "FPS: " + currentFramerate;
            fpsCount = 0;

            if (Math.floor(Math.random() * 1000) == 1) {
                increaseStatic("100%", 1000, 2, true);
                
            }
            if (gameStarted) {
                currentUpdateFPSTimeout = setTimeout(updateFPS, 1000);
            }
        }


        const soundEffectsDir = {
            "Animatronics": ["jumpscare.mp3", "trimmednightmarespudjumpscare.mp3", "animatronicindoor.mp3", "flippyknockingondoor.ogg", "run.wav", "running fast3.wav", "deep steps.wav", "VocalsBreaths1.wav", "VocalsBreaths2.wav", "VocalsBreaths3.wav", "VocalsBreaths4.wav", "KingSpudIsAngry.mp3", "KingSpudIsNowAngry.mp3"],
            "Player": ["door.mp3", "camera.mp3", "changeCam.mp3", "garble1.wav", "garble2.wav", "garble3.wav"],
            "Random": ["ventcrawl.mp3", "bblaugh.mp3", "bbhello.mp3", "bbhi.mp3", "laugh1.wav", "laugh2.wav", "laugh3.wav", "laugh4.wav"],
            "Other": ["horhorhorhorhorhorhorhorhorhor.mp3", "nightstart.mp3", "finishednight.mp3", "powerdown.wav"],
            "Ambience": ["foxysong.wav"],
            "Calls": ["phone0.wav", "phone1.wav", "phone2.wav", "phone3.wav", "phone4.wav"]
        }
        //"nightstart.mp3", "ambience.mp3", "eerie.wav", "buzzing.wav", "eerie2.wav", "what.mp3", "oof.mp3", "hallway.mp3"
        //"jumpscare2.mp3"




        // PRELOAD AUDIO
        const allAudio = {};
        const sfxDir = "./SFX/";

        function cancelAllAudio() {
            
            const audios = document.querySelectorAll("audio");
            audios.forEach(a => {
                if (!a.paused) {
                    a.pause();
                    a.currentTime = 0;
                }
            });
            
           Object.values(allAudio).forEach(a => {
                if (!a.paused) {
                    a.pause();
                    a.currentTime = 0;
                }
           });
        }

        
        for (let i=0; i<Object.values(soundEffectsDir).length; i++) {
            for (let j=0; j<Object.values(soundEffectsDir)[i].length; j++) {
                let sfx = new Audio(sfxDir + Object.keys(soundEffectsDir)[i] + "/" + Object.values(soundEffectsDir)[i][j]);
                allAudio[Object.values(soundEffectsDir)[i][j]] = sfx;
            }
        };

        function playAudio(sfxName) {
            try {
            if (!Object.keys(allAudio).includes(sfxName)) {
                alert("Audio Not Found: " + sfxName);
                return;
            }
            let curSFX = allAudio[sfxName]; 
            if (!curSFX.paused) {
                curSFX.pause();
                curSFX.currentTime = 0;
            }
            curSFX.play();
            } catch (er) {
                alert(er);
            }
        }

        const victoryScreen = document.getElementById("victoryScreen");
        const AMTransition = document.getElementById("AMTransition");
        // mainGame.style.display = "none";
        function victory() {
            clearTimeout(currentUpdateFPSTimeout);
            clearTimeout(currentAddHourTimeout);
            clearTimeout(randomSoundsTimeout);

            cancelAllAudio();

            /*
            if (!fanAudio.paused) {
                fanAudio.pause();
            }
            if (!jukebox.paused) {
                jukebox.pause();
            }
            */
           
            if (nightPlaying > 0) {
                clearInterval(passiveDrainInterval);
            }
            if (flippysSongId) {
                clearInterval(flippysSongId);
            }
            for (let i=0; i<Object.values(allTimeouts).length; i++) {
                clearTimeout(Object.values(allTimeouts)[i]);
            } 

            gameStarted = false;
            if (nightPlaying < 6) {
                updateNight(nightPlaying+1);
            }
            
            victoryScreen.style.display = "flex";
            setTimeout(function() {
                AMTransition.textContent = "5";
                victoryScreen.style.opacity = "100%";
                playAudio("finishednight.mp3");

                setTimeout(function() {
                    AMTransition.style.top = "24%";
                    AMTransition.style.opacity = 0;
                    setTimeout(function() {
                        AMTransition.style.transition = "none";
                        AMTransition.style.top = "60%";
                        setTimeout(function() {
                            AMTransition.style.transition = "1s";
                            AMTransition.textContent = "6";
                            AMTransition.style.top = "42%";
                            AMTransition.style.opacity = "100%";
                            setTimeout(async function() {
                                try {
                                victoryScreen.style.opacity = "";
                                if (nightPlaying >= 4) {
                                    // ENDING PAYCHECKS
                                    cutscene.src = cutsceneImages[nightPlaying];
                                    cutscene.style.transform = "scale(100%)"
                                    cutscene.style.opacity = "0";
                                    cutscene.style.display = "block";
                                    cutscene.style.transform = "scale(110%)";
                                    cutscene.style.opacity = "100%";
                                    await new Promise(resolve => setTimeout(resolve, 10000));
                                    cutscene.style.opacity = "0";
                                }

                                if (Math.floor(Math.random() * 30) == 0) {
                                    creepySpudHallucinate();
                                    return;
                                }

                                mainMenu.style.display = "flex";
                                RealMenu.style.display = "flex";
                                RealMenu.style.opacity = "100%";
                                /*
                                title.style.display = "flex";
                                startBtn.style.display = "flex";
                                title.style.opacity = "100%";
                                startBtn.style.opacity = "100%";
                                */
                                titleScreen.style.display = "flex";
                                titleScreen.style.opacity = "100%";
                                drawingTSStatic = true;
                                drawTitleScreenStatic();
                                menuMusic2.play();

                                
                                setTimeout(function() {
                                    victoryScreen.style.display = "none";
                                    cutscene.style.display = "none";
                                }, 2000);
                                } catch (er) {
                                    alert(er);
                                }
                            }, 5000);
                        }, 500);
                    }, 500);
                }, 2500);
            });
        }


        let beingStaredAt = false;
        let time = 0;
        const timeText = document.getElementById("Time");
        function addHour() {
            time += 1;
            timeText.textContent = time + " AM";
            // INCREASE TEXT TIME

            if (time == 2) {
                entities["Sampler"]["Agro"]++;
            } else if (time == 3 || time == 4) {
                entities["Sampler"]["Agro"]++;
                entities["PairProgrammers"]["Agro"]++;
                entities["FlippyDoo"]["Agro"]++;
            } if (time >= 6) {
                victory();
                //alert("6 AM!!!!!!!");
            }
            currentAddHourTimeout = setTimeout(addHour, 89000);
        }
/*
3.02: KingSpud/fred
4.97: sampler/bon
4.98: pairprogrammers/chi
5.01: flippydoo/fo
*/
        const agroPerNight = {
            "KingSpud": [0, 0, 1, 2, 3, 4], // [0, 20, 1, 2, 3, 4]
            "Sampler": [0, 3, 0, 2, 5, 10], // [0, 3, 0, 2, 5, 10],
            "PairProgrammers": [0, 1, 5, 4, 7, 12], // [0, 1, 5, 4, 7, 12]
            "FlippyDoo": [0, 1, 2, 6, 5, 16] // [0, 1, 2, 6, 5, 16]
        }
/*
NORMAL
Night	Freddy	Bonnie	Chica	Foxy
1	    0	    0	    0	    0
2	    0	    3	    1	    1
3	    1	    0	    5	    2
4	    1-2*	2	    4	    6
5	    3	    5	    7	    5
6	    4	    10	    12	    16

2 AM: Bonnie lvl +1
3 AM: Bonnie, Chica, Foxy lvl +1
4 AM: Bonnie, Chica, Foxy lvl +1

AGRO LEVELS AT 4AM
Night	Freddy	Bonnie	Chica	Foxy
1	    0	    3	    2	    2
2	    0	    6	    3	    3
3	    1	    3	    7	    4
4	    1-2*	5	    6	    8
5	    3	    8	    9	    7
6	    4	    13	    14	    18

* = 50/50 chance

*/


        const jumpscareAudio = document.getElementById("jumpscareAudio");
        const gameOverScreen = document.getElementById("gameOverScreen");
        const gameOverGotBy = document.getElementById("gameOverGotBy");
        const gameOverMusic = document.getElementById("gameOverMusic");
        let onGameOverScreen = false;

        /*
        for (let i=0; i<Object.keys(entities).length; i++) {
            let vid = document.createElement("video");
        }
        */

        /*
        let jumpscareVids = {};
        for (let i=0; i<Object.keys(entities).length; i++) {
            let scaryahhthing = document.createElement("video");
            scaryahhthing.style.display = "none";
            scaryahhthing.src = "./Animatronics/" + Object.values(entities)[i]["Name"] + "/jumpscare.mp4";
            scaryahhthing.classList.add("jumpscare");
            jumpscareVids[Object.values(entities)["Name"]] = scaryahhthing;
            document.body.appendChild(scaryahhthing);
        }
        */
        // PRELOAD JUMPSCARES
        const jumpscareImages = {
            "FlippyDoo": [],
            "KingSpud": [],
            "PairProgrammers": [],
            "Sampler": []
        }
        
        async function loadImage(directory) {
            return new Promise(resolve => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.src = directory;
            });
        }
        async function loadImages() {
            for (let j=0; j<Object.keys(jumpscareImages).length; j++) {
                let curAnimatronic = Object.keys(jumpscareImages)[j];
                for (let i=1; i<25; i++) {
                    const img = await loadImage("./Animatronics/" + curAnimatronic + "/Animation/" + i + ".png");
                    jumpscareImages[curAnimatronic].push(img);
                }
            }

            jumpscareImages["FlippyRun"] = [];
            for (let i=1; i<26; i++) {
                const img = await loadImage("./Animatronics/FlippyDoo/RunAnimation/" + i + ".png");
                jumpscareImages["FlippyRun"].push(img);
            }
        }
        loadImages();


        /*
        for (let j=0; j<Object.keys(jumpscareImages).length; j++) {
            if (j == 0 || j == 1) {
            for (let i=0; i<25; i++) {
                
                const img = new Image();
                img.src = "./Animatronics/" + Object.keys(jumpscareImages)[j] + "/Animation/" + i + ".png";

                img.onload = function() {  
                    jumpscareImages[Object.keys(jumpscareImages)[j]].push(img);
                };
                
                //jumpscareImages[Object.keys(jumpscareImages)[j]].push(img);
            }
            }
        }
        */

        let animationList;
        let animationFrame;
        

        /*
        canvasOverlay.style.display = "flex";
        function asdf() {

                canvasOverlayCTX.fillStyle = "black";
                canvasOverlayCTX.fillRect(0, 0, screenWidth, screenHeight);
                canvasOverlayCTX.fillStyle = "white";
                canvasOverlayCTX.fillRect(0, Math.floor(Math.random()*screenHeight), screenWidth, 25);
                canvasOverlayCTX.fillRect(0, Math.floor(Math.random()*screenHeight), screenWidth, 25);

                setTimeout(asdf, 50);
        }
        asdf();
        */

        function renderAnimation() {
            try {
            canvasOverlayCTX.clearRect(0, 0, canvasOverlay.width, canvasOverlay.height);
            /*
            const img = new Image();
            img.src = "./Animatronics/FlippyDoo/Animation/" + animationFrame + ".png";
            canvasOverlayCTX.drawImage(img, 0, 0);
            */
            canvasOverlayCTX.drawImage(animationList[animationFrame], 0, 0, canvasOverlay.width, canvasOverlay.height);
            
            animationFrame++;
            if (animationFrame <= 23) {
                // requestAnimationFrame makes it faster on second time showing (?)
                //window.requestAnimationFrame(renderAnimation);
                setTimeout(renderAnimation, 33);
            }
            } catch (er) {
                alert(er + ", " + animationFrame);
                alert(animationList);
                alert(animationList[animationFrame]);
            }
        }


        let runningStatic;
        function staticEffect() {
            if (runningStatic) {

                canvasOverlayCTX.fillStyle = "black";
                canvasOverlayCTX.fillRect(0, 0, screenWidth, screenHeight);
                canvasOverlayCTX.fillStyle = "white";
                canvasOverlayCTX.fillRect(0, Math.floor(Math.random()*screenHeight), screenWidth, 50);
                canvasOverlayCTX.fillRect(0, Math.floor(Math.random()*screenHeight), screenWidth, 25);

                setTimeout(staticEffect, 50);
            }
        }

        function jumpscare(entityName) {
            gameStarted = false;
            clearTimeout(currentUpdateFPSTimeout);
            clearTimeout(currentAddHourTimeout);
            clearTimeout(randomSoundsTimeout);

            if (nightPlaying > 0) {
                clearInterval(passiveDrainInterval);
            }
            if (flippysSongId) {
                clearInterval(flippysSongId);
            }
            for (let i=0; i<Object.values(allTimeouts).length; i++) {
                try {
                    clearTimeout(Object.values(allTimeouts)[i]);
                } catch (er) {
                    alert(er);
                }
            } 

            try {
                
            canvasOverlayCTX.clearRect(0, 0, canvasOverlay.width, canvasOverlay.height);
            canvasOverlay.style.display = "flex";

            cancelAllAudio();

            if (Object.keys(jumpscareImages).includes(entityName)) {
                animationList = jumpscareImages[entityName];//"./Animatronics/" + entity + "/Animation/";
                animationFrame = 0;
                window.requestAnimationFrame(renderAnimation);

                mainRoom.style.animation = "shake .5s";
                mainRoom.style.animationIterationCount = "infinite";
                mainRoom.style.scale = "108%";

                jumpscareAudio.play();
            }

            if (!fanAudio.paused) {
                fanAudio.pause();
            }
            if (!gameplayMusic.paused) {
                gameplayMusic.pause();
            }
            
            } catch (er) {
                alert(er);
            }
            
            /*
            let jsVid = jumpscareVids[entityName];
            // would do an if !paused... but how... *illuminati music*
            jsVid.pause();
            jsVid.currentTime = 0;
            jsVid.style.display = "flex";
            jsVid.play();
            */

            camera.style.transform = "perspective(1000px) rotateX(90deg)";

            //alert("BOO!");

            setTimeout(function() {

                mainRoom.style.animation = "";
                mainRoom.style.animationIterationCount = "";
                mainRoom.style.scale = "";

                //jsVid.style.display = "none";
                jumpscareAudio.pause();
                jumpscareAudio.currentTime = 0;

                runningStatic = true;
                staticEffect();

                gameOverScreen.style.display = "flex";
                gameOverGotBy.textContent = "Got By: " + entityName;
                setTimeout(function() {
                    runningStatic = false;
                    canvasOverlayCTX.fillStyle = "black";
                    canvasOverlayCTX.fillRect(0, 0, screenWidth, screenHeight);
                    //canvasOverlay.style.display = "none";
                    gameOverScreen.style.opacity = "100%";
                    onGameOverScreen = true;
                    titleScreen.style.opacity = 0;

                    gameOverMusic.play();
                    
                    //playAudio("horhorhorhorhorhorhorhorhorhor.mp3");
                }, 2000);
            }, 1000);
        }
        
        const gameOverContinueButton = document.getElementById("gameOverContinueButton");
        const gameOverMainMenuButton = document.getElementById("gameOverMainMenuButton");

        gameOverContinueButton.addEventListener("click", function() {
            if (onGameOverScreen) {

                if (!gameOverMusic.paused) {
                    gameOverMusic.pause();
                    gameOverMusic.currentTime = 0;
                }

                gameOverScreen.style.opacity = "0";
                // FADE IN ANIMATION;
                setTimeout(function() {
                    gameOverScreen.style.display = "none";
                    startGame();
                }, 4000);
                
                onGameOverScreen = false;
            }
        });

        // need to set opacity to 0 for fade later
        
        gameOverMainMenuButton.addEventListener("click", function() {
            if (onGameOverScreen) {
                
                if (!gameOverMusic.paused) {
                    gameOverMusic.pause();
                    gameOverMusic.currentTime = 0;
                }

                if (Math.floor(Math.random() * 30) == 0) {
                    creepySpudHallucinate();
                    return;
                }


                gameOverScreen.style.display = "none";
                gameOverScreen.style.opacity = "0";
                canvasOverlay.style.display = "none";

                glowyText.style.display = "none";

                mainMenu.style.display = "flex";
                RealMenu.style.display = "flex";
                RealMenu.style.opacity = "100%";

                /*
                title.style.opacity = "100%";
                startBtn.style.opacity = "100%";
                */
                titleScreen.style.opacity = "100%";
                drawingTSStatic = true;
                drawTitleScreenStatic();

                menuMusic2.play();
                onGameOverScreen = false;
            } else {
                alert("how'd you click this?!?");
            }
        });

        const cameraRelativity = {
            "C1A": ["DoorLeft", "C1B"],
            "C1B": ["C1A", "C2", "C3A"],
            "C2": ["DoorRight", "C1B"],
            "C3A": ["C3B", "C1B"],
            "C3B": ["C3A", "C6", "C7"],
            "C4A": ["C4B", "C7"],
            "C4B": ["C5", "C7"],
            "C5": ["C6", "C4B"],
            "C6": ["C5", "C3B", "C7"],
            "C7": ["C4B", "C3B", "C1A", "C2"],

            "DoorLeft": ["C1A"],
            "DoorRight": ["C2"]
        };


        const buttons = [];
        buttonLocations = [[35, 50], [164, 50]];
        const hallwayLocations = {
            "PairProgrammers": {
                "DoorLeft": 51,
                "DoorRight": 48
            },
            "Sampler": {
                "DoorLeft": 55,
                "DoorRight": 46
            }
            /*
            "PairProgrammers": {
                "DoorLeft": 23,
                "DoorRight": 34
            },
            "Sampler": {
                "DoorLeft": 34,
                "DoorRight": 20
            }
            */
        }
        // animatronics in hallway
        let hallwayImagesUsed = 0;
        const hallwayImages = [];
        for (let i=0; i<2; i++) {
            let img = document.createElement("img");
            img.classList.add("hallwayAnimatronicImage");
            img.style.display = "none";
            hallwayImages.push(img);
            mainGame.appendChild(img);
        }

        // [0] = left door, [1] = right door
        const isDoorClosed = [];
        const isLightOn = [];
        const doors = document.querySelectorAll(".doors");

        const lightsOn = document.getElementById("lightsOn");
        

        function resetButtons() {
            for (let i=0; i<2; i++) {
                if (isDoorClosed[i]) {
                        doors[i].style.top = "-47%";
                        buttons[(i*2)+1].style.backgroundColor = "red";
                        // only need the fancy stuff if players actually playing, not at start of game
                        if (powerOut) {
                            playAudio("door.mp3");
                            updateBatteryLoss(-1);
                        }
                        isDoorClosed[i] = false;
                }
                if (isLightOn[i]) {
                    isLightOn[i] = false;
                }
                hallwayImages[i].style.display = "none";
            }
        }
        
        // list buttons format is light, door, light, door
        function cancelLight(lightNum) {
            if (isLightOn[lightNum]) {
                if (!lightsOn.paused) {
                    lightsOn.pause();
                    lightsOn.currentTime = 0;
                }
                isLightOn[lightNum] = false;
                buttons[(lightNum*2)].style.backgroundColor = "rgb(133, 133, 133)";
                hallways.style.display = "none";
                updateBatteryLoss(-1);
                for (let i=0; i<hallwayImages.length; i++) {
                    hallwayImages[i].style.display = "none";
                }
                hallwayImagesUsed = 0;
            }
        }
        for (let i=0; i<buttonLocations.length; i++) {
            const doorBtn = document.createElement("button");
            doorBtn.classList.add("controlButtons");
            doorBtn.style.left = buttonLocations[i][0] + "%";
            doorBtn.style.top = buttonLocations[i][1] + "%";
            doorBtn.style.backgroundColor = "red";

            const lightBtn = document.createElement("button");
            lightBtn.classList.add("controlButtons");
            
            lightBtn.style.left = buttonLocations[i][0] + "%";
            lightBtn.style.top = (buttonLocations[i][1] + 10) + "%";

            isDoorClosed[i] = false;
            doorBtn.addEventListener("click", function() {
                if (!powerOut) {
                    playAudio("door.mp3");
                    if (isDoorClosed[i]) {
                        doorBtn.style.backgroundColor = "red";
                        doors[i].style.top = "-47%";
                        updateBatteryLoss(-1);
                        isDoorClosed[i] = false;
                    } else {
                        doorBtn.style.backgroundColor = "green";
                        doors[i].style.top = "0";
                        updateBatteryLoss(1);
                        isDoorClosed[i] = true;
                    }
                }
            });

            isLightOn[i] = false;
            lightBtn.addEventListener("mousedown", function () {
                if (!powerOut) {
                    if (!isLightOn[i]) {
                        isLightOn[i] = true;
                        lightsOn.play();
                        
                        lightBtn.style.backgroundColor = "rgb(183, 183, 183)";
                        hallways.style.display = "block";
                        updateBatteryLoss(1);

                        for (let ent in entities) {
                            if (((entities[ent]["Location"] == "DoorLeft" && !isDoorClosed[0] && isLightOn[0]) || (entities[ent]["Location"] == "DoorRight" && !isDoorClosed[1] && isLightOn[1])) && (ent == "Sampler" || ent == "PairProgrammers")) {
                                playAudio("animatronicindoor.mp3");
                            }
                            if (entities[ent]["Location"] == "DoorLeft" || entities[ent]["Location"] == "DoorRight") {
                                hallwayImages[hallwayImagesUsed].style.transform = "translate(" + mainRoomPosition + "vw, 0)";
                                hallwayImages[hallwayImagesUsed].src = "./Animatronics/" + ent + "/" + entities[ent]["Location"] + ".png";
                                hallwayImages[hallwayImagesUsed].style.left = hallwayLocations[ent][entities[ent]["Location"]] + "%";
                                hallwayImages[hallwayImagesUsed].style.display = "block";
                                hallwayImagesUsed++;
                            }
                        }
                    }
                } // play error
            });

            lightBtn.addEventListener("mouseleave", function() {
                cancelLight(i);
            });

            lightBtn.addEventListener("mouseup", function() {
                cancelLight(i);
            });

            buttons.push(lightBtn);
            buttons.push(doorBtn);
            document.body.appendChild(doorBtn);
            document.body.appendChild(lightBtn);
        };


        let translating = false;
        const fan = document.getElementById("fan");

        function translateScreen() {
            //if (translating != false && ((translating == 1 && mainRoomPosition < -40) || (translating == -1 && mainRoomPosition > -60))) {
            
            if (translating != false && ((translating == 1 && mainRoomPosition < lowerBound) || (translating == -1 && mainRoomPosition > upperBound))) {

                //info.textContent = ("translate(" + mainRoomPosition + "vw, 0)");

                mainRoomPosition += (translating * 1.2);

                mainRoom.style.transform = "translate(" + mainRoomPosition + "vw, 0)";
                for (let i=0; i<buttons.length; i++) {buttons[i].style.transform = "translate(" + mainRoomPosition + "vw, 0)";}
                

                hallways.style.transform = "translate(" + mainRoomPosition + "vw, 0)";
                fan.style.transform = "translate(" + mainRoomPosition + "vw, 0)";
 
                for (let i=0; i<doors.length; i++) {
                    
                    doors[i].style.transition = "none";
                    doors[i].style.transform = "translate(" + mainRoomPosition + "vw, 0)";
                    window.requestAnimationFrame(() => {
                        doors[i].style.transition = "";
                    });    
                }

                if (hallwayImagesUsed > 0) {
                    for (let i=0; i<hallwayImagesUsed; i++) {
                        hallwayImages[i].style.transform = "translate(" + mainRoomPosition + "vw, 0)";
                    }
                }
                if (powerOut) {glowyEyes.style.transform = "translate(" + mainRoomPosition + "vw, 0)";}


                //if (mainRoomPosition < -60 || mainRoomPosition > -40) {
                if (mainRoomPosition < upperBound || mainRoomPosition > lowerBound) {
                    translating = false;
                    return;
                } else {
                    window.requestAnimationFrame(translateScreen);
                }
            }
        }

        const staticNoises = [];
        let lastStatic;
        for (let i=1; i<4; i++) {
            let aud = document.createElement("audio");
            aud.src = "./SFX/Player/static" + i + ".wav";
            staticNoises.push(aud);
            document.body.appendChild(aud);
        }
        // ADD THIS TO GAMESTARTED FUNCTIONS SO NO CHECK EVERY FRAME
        document.addEventListener("mousemove", function (event) {
            if (!gameStarted) {return};
            //info.textContent = `${event.clientX}, ${event.clientY} /// ${screenWidth} - ${screenOffsetX} /// ${screenHeight} - ${screenOffsetY}`;
            if (!moved) {
                if (event.clientX > (screenWidth - screenOffsetX) && !cameraOnScreen) {
                    moved = true;
                    info.textContent = "right";
                    translating = -1;
                    translateScreen();
                } else if (event.clientX < screenOffsetX && !cameraOnScreen) {
                    moved = true;
                    translating = 1;
                    translateScreen()
                    info.textContent = "left";
                } else if (event.clientY > (screenHeight - screenOffsetY) && event.clientX < screenWidth - (screenOffsetX * 4) && event.clientX > (screenOffsetX * 4) && !powerOut) {
                    info.textContent = "bottom";
                    moved = true;

                    playAudio("camera.mp3");

                    if (cameraOnScreen) {
                        lastStatic.pause();
                        updateBatteryLoss(-1);
                        fanAudio.play();
                        //camera.style.top = "100%";
                        camera.style.transform = "perspective(1000px) rotateX(90deg)";
                        cameraOnScreen = false;
                        /*
                        if (beingStaredAt) {
                            for (let ent in entities) {
                                if ((entities[ent]["Location"] == "DoorLeft" && !isDoorClosed[0]) || (entities[ent]["Location"] == "DoorRight" && !isDoorClosed[1])) {
                                    playAudio("animatronicindoor.mp3");
                                }
                            }
                        }
                        */
                    } else {
                        lastStatic = staticNoises[Math.floor(Math.random()*3)];
                        lastStatic.play();
                        camCheckedForFlippy = true;
                        updateBatteryLoss(1);
                        fanAudio.pause();
                        //camera.style.top = 0;
                        drawEntities();
                        camera.style.transform = "perspective(1000px) rotateX(0deg)";
                        cameraOnScreen = true;
                        if (beingStaredAt) {
                            /*
                            if (!(entity["Location"] == "C1A" && isDoorClosed[0] || entity["Location"] == "C2" && isDoorClosed[1])) {
                                jumpscare();
                            }
                            */
                        }
                        /*
                        if (flippyCharging) {
                            if (!(currentCameraNum == "C1A")) {
                                currentCameraNum = "C1A";
                                cameraImage.src = "./Cameras/C1A.jpg"; 
                            }

                            // FLIPPY CHARGE
                            playAudio("run.wav");
                            flippyCharging = false;
                            clearTimeout(flippyChargeTimeout);
                            //jumpscare("FlippyDoo");
                        }
                        */
                    }
                }
            } else {
                if (event.clientX < (screenWidth - screenOffsetX) && event.clientX > screenOffsetX && event.clientY < (screenHeight - screenOffsetY)) {
                    info.textContent = "none";
                    moved = false;
                }
            }
        });


        /*
        3.02s freddy chance, not if camera on
        if Freddy is on stage 2 (aka camera 4B) Freddy will fail his movement if you're looking at 4B, or in the office.
        if freddy is 9 ai, looking at camera makes him fail every movement opportunity for 100 frames

        4.97s bonnie
        4.98s chica
        IF AT DOOR & MOVE:
            - 1. if door open, they jam it, and oof next time camera put down
            - 2. if closed, they leave

        5.01 foxie, move veery time if cameras not used. if any camera used in that interval, foxie will not move
        */

        const AnimatronicImageOffsets = {
            "KingSpud": {
                "C1A": [0, 0],
                "C1B": [0, 0],
                "C2": [0, 0],
                "C3A": [0, 0],
                "C3B": [1, 0],
                "C4A": [0, 0],
                "C4B": [0, 0],
                "C5": [0, 0],
                "C6": [0, 0],
                "C7": [0, 0],
            },
            "FlippyDoo": {
                "C1A": [0, 0],
                "C1B": [0, 0],
                "C2": [0, 0],
                "C3A": [0, 0],
                "C3B": [0, 0],
                "C4A": [0, 0],
                "C4B": [0, 0],
                "C5": [0, 0],
                "C6": [0, 0],
                "C7": [0, 0],
            },
            "PairProgrammers": {
                "C1A": [0, 0],
                "C1B": [0, 0],
                "C2": [0, 0],
                "C3A": [0, 0],
                "C3B": [0, 0],
                "C4A": [0, 0],
                "C4B": [0, 0],
                "C5": [0, 0],
                "C6": [-4, -2],
                "C7": [0, 0],
            },
            "Sampler": {
                "C1A": [0, 0],
                "C1B": [0, 0],
                "C2": [0, 0],
                "C3A": [0, 0],
                "C3B": [0, 0],
                "C4A": [0, 0],
                "C4B": [0, 0],
                "C5": [0, 0],
                "C6": [0, 0],
                "C7": [0, 0],
            }
        }

        let flippysSongId;
        function flippysSong() {
            if (!gameStarted) {
                clearInterval(flippysSongId);
            } if (entities["FlippyDoo"]["CurrentStage"] != 0) {
                clearInterval(flippysSongId);
            } else if (Math.floor(Math.random() * 30) == 1) {
                clearInterval(flippysSongId);
                playAudio("foxysong.wav");
            }
        }

        //1) C5, 2) C4B, 3) C7, 4) C3B, 5) C3A, 6) C1B, 7) C2
        // OG:1) Stage, 2) Dining, 3) Restrooms, 4)  Kitchen, 5) East Hall, 6) East Hall Corner, 7) Your Office
        // NEW: 1) Storage Room, 2) North Hall, 3), Outdoor Top, 4) Outdoor Bottom, 5) Below 6) Right 7) Your Office  -> ["C6", "C7", "C3B", "C3A", "C1B", "C2"];
        // NEWER NEW: 1) Storage Room, 2) Kitchen, 3) Gym, 4) North Hall, 5) Left Door, 6) South Hall, 7) Right Window 8) Your Office
        const KingSpudPath = ["C6", "C7", "C3B", "C3A", "C1B", "C2"];// ["C5", "C4B", "C7", "C3B", "C3A", "C1B", "C2"];
        const KingSpudNoises = ["running fast3.wav", "running fast3.wav", "running fast3.wav", "running fast3.wav", "KingSpudIsAngry.mp3", "KingSpudIsNowAngry.mp3"]
        // one minute / agro
        function moveEntity(entity) {
            if (!gameStarted) {
                return;
            }
            if (((Math.random() * 20)+1) <= entity["Agro"]) {
                if (entity["Attack"] == "Instant") {
                    if (!camCheckedForFlippy && !cameraOnScreen && !flippyCharging && !drawingFlippyRun) {
                        entity["CurrentStage"]++;
                        if (entity["CurrentStage"] < 4) {
                            if (flippysSongId) {
                                clearInterval(flippysSongId);
                                flippysSongId = null;
                            }
                            increaseStatic("100%", 200, 2, true);
                            if (currentCameraNum == "C4A") {
                                cameraImage.src = "./Cameras/C4A" + entities["FlippyDoo"]["CurrentStage"] + ".png";
                            }
                        } else {
                            if (currentCameraNum == "C4A") {
                                cameraImage.src = "./Cameras/C4A5.png";
                            }
                            flippyCharging = true;
                            flippyChargeTimeout = setTimeout(function() {
                                flippyCharging = false;
                                jumpscare("FlippyDoo");
                            }, 25000);
                        }
                    } else {
                        camCheckedForFlippy = false;
                    }
                    setTimeout(moveEntity, entity["MoveTime"]*1000, entity);
                    return;
                }
                /*
                is camera on screen?
                /          \
               NO         YES
               /            \
             MOVE       if cameraNum != location
                              \
                            MOVE

                "Once Freddy reaches the East Hall Corner, he will look for an opportunity to get in the office. He cannot advance from htis point if the camera is not up, or if the camera is selected on the east Hall Corner. You can permanently freeze Freddy by only watching cam 4b, but since this can be a bit risky with not being able to check Foxy..."
                */
                if (entity["Attack"] == "SetPath") {
                    if (entity["Location"] == "C2") {
                        if (!cameraOnScreen && !(currentCameraNum == "C2")) {
                            if (!isDoorClosed[1]) {
                                playAudio("KingSpudIsAngry.mp3");
                                entity["Location"] = "DoorRight";
                            } else {
                                entity["Location"] = "C1B";
                            }
                        } else {
                            entity["Location"] = "C1B";
                        }
                    } else {
                        if (!cameraOnScreen || currentCameraNum != entity["Location"]) {
                            if (entity["Location"] == "DoorRight") {
                                jumpscare(entity["Name"]);
                            } else {
                                playAudio(KingSpudNoises[Math.floor(Math.random()*KingSpudNoises.length)]);
                                if (currentCameraNum == entity["Location"]) {increaseStatic("100%", 500, 2, true);}
                                entity["Location"] = KingSpudPath[KingSpudPath.indexOf(entity["Location"])+1];
                                if (currentCameraNum == entity["Location"]) {increaseStatic("100%", 500, 2, true);}
                            }
                            //if (cameraRelativity[entity["Location"]])
                        }
                    }
                    setTimeout(moveEntity, entity["MoveTime"]*1000, entity);
                    return;
                }

                // CHECK IF DOOR IS OPEN
                if ((entity["Location"] == "DoorLeft" && !isDoorClosed[0]) || (entity["Location"] == "DoorRight" && !isDoorClosed[1])) {
                    jumpscare(entity["Name"]);
                    return;
                }
                

                let oldLocation = false;
                if (currentCameraNum == entity["Location"] && entity["Location"] != "C5") {
                    increaseStatic("100%", 500, 2, true);
                    oldLocation = true;
                }

                let newLocation = cameraRelativity[entity["Location"]][(Math.floor(Math.random() * cameraRelativity[entity["Location"]].length))];
                entity["Location"] = newLocation;
                if (oldLocation) {
                    drawEntities();
                }
                
                playAudio("deep steps.wav");

                if (currentCameraNum == newLocation) {
                    increaseStatic("100%", 500, 2, true);
                    drawEntities();
                }
                
                if (entity["Location"] == "DoorLeft" || entity["Location"] == "DoorRight") {
                    beingStaredAt = true;
                    if (!cameraOnScreen) {
                        if ((entity["Location"] == "DoorLeft" && !isDoorClosed[0] && isLightOn[0]) || (entity["Location"] == "DoorRight" && !isDoorClosed[1] && isLightOn[1])) {
                            playAudio("animatronicindoor.mp3");
                        }
                    } else {
                        playAudio(("VocalsBreaths" + (Math.floor(Math.random()*4)+1) + ".wav"));
                        //VocalsBreaths1.wav
                    }
                }
            }
            const settedTimeouted = setTimeout(moveEntity, entity["MoveTime"]*1000, entity);
            allTimeouts[entity["Name"]] = settedTimeouted;
        }

        //let maxWaitTime = 60000;

        const cameraImages = {
            "C1A": "C1A.jpg",
            "C1B": "C1B.jpg",
            "C2": "C2.jpg",
            "C3A": "C3A.jpg",
            "C3B": "C3B.jpg",
            "C4A": "1.png",
            "C4B": "C4B.jpg",
            "C5": "C5.png",
            "C6": "C6.png",
            "C7": "C7.jpg",
        };
        const cameraImage = document.getElementById("currentCameraImage");
        
        const animatronicImages = [];
        for (let i=0; i<4; i++) {
            const img = document.createElement("img");
            img.classList.add("animatronicImage");
            //img.src = "./Animatronics/KingSpud/C3B.png";
            animatronicImages.push(img);
            camera.appendChild(img);
        }
        /*
        for (let entityName in entities) {
            for (let camLoc in cameraImages) {
                let img = document.createElement("img");
                img.classList.add("animatronicImage");
                if (entityName == "KingSpud") {
                img.src = "./Animatronics/" + entityName + "/" + camLoc + ".png";
                } else {
                img.src = "./Animatronics/KingSpud/C3A.png";
                }
                animatronicImages.push(img);
                camera.appendChild(img);
            }
        }
        */
        
        const kitchenAudio = document.getElementById("kitchenAudio");

        function drawEntities() {
            for (let i=0; i<animatronicImages.length; i++) {
                animatronicImages[i].style.display = "none";
            }
            let animatronicFound = false;
            for (let i=0; i<Object.keys(entities).length; i++) {
                if (Object.values(entities)[i]["Location"] == currentCameraNum) {
                    animatronicFound = true;
                    //alert(Object.values(entities)[i]["Name"]);
                    if (currentCameraNum != "C5" && currentCameraNum != "C4A") {
                        if (Object.values(entities)[i]["Name"] != "KingSpud" || (KingSpudPath.includes(currentCameraNum))) {
                            animatronicImages[i].src = "./Animatronics/" + Object.values(entities)[i]["Name"] + "/" + currentCameraNum + ".png";
                            animatronicImages[i].style.display = "flex";
                            animatronicImages[i].style.left = AnimatronicImageOffsets[Object.values(entities)[i]["Name"]][currentCameraNum][0] + "%";
                            animatronicImages[i].style.top = AnimatronicImageOffsets[Object.values(entities)[i]["Name"]][currentCameraNum][1] + "%";
                        }
                    }
                }
            }
            if (currentCameraNum == "C5" && animatronicFound) {
                kitchenAudio.play();
                animatronicFound = true;
            } else if (currentCameraNum != "C5") {
                if (!kitchenAudio.paused) {
                    kitchenAudio.pause();
                }
            }
        }


        let timesFoxyBlocked = 0;
        const curAnimatronicImgs = [];
        for (let i=0; i<cameras.length; i++) {
            cameras[i].addEventListener("click", function () {
                if (currentCameraNum == cameras[i].textContent) {return;}
                increaseStatic("70%", 200, 2);
                playAudio("changeCam.mp3");
                /*
                static.style.opacity = "70%";
                staticDuration = 2;
                setTimeout(function() {
                    static.style.opacity = "10%";
                    cameraSwitching = false;
                    staticDuration = 10;
                }, 200);
                */
                
                currentCameraNum = cameras[i].textContent;
        
                /*
                // REPLACED WITH DRAWENTITIES
                const entitiesInfo = Object.values(entities);
                for (let j=0; j<entitiesInfo.length; j++) {
                    if (entitiesInfo[j]["Location"] == cameras[i].textContent) {
                        //alert(Object.keys(entities)[j]);
                    }
                }
                */

                if (flippyCharging) {
                    if (i == 5) {
                        // C1A, left hall, where flippy charge animation
                        flippyCharging = false;
                        clearTimeout(flippyChargeTimeout);
                        playAudio("run.wav");

                        // FLIPPY CHARGE - DRAW THE RUNNING ANIMATION HERE
                        drawingFlippyRun = true;
                        /*
                        const flippyImg = document.getElementById("flippyImg");
                        flippyImg.style.right = 0;
                        flippyImg.style.top = 0;
                        */

                        setTimeout(function() {
                            if (isDoorClosed[0]) {
                                playAudio("flippyknockingondoor.ogg");
                                battery -= 1 + (timesFoxyBlocked * 5)
                                timesFoxyBlocked++;
                                
                                setTimeout(function() {
                                    // as long as < 4
                                    entities["FlippyDoo"]["CurrentStage"] = Math.floor(Math.random() * 4);
                                }, 3000);
                            } else {
                                jumpscare("FlippyDoo");
                            }
                        }, 2000);
                        // don't draw other entities on top
                    } else if (drawingFlippyRun) {
                        flippyRunIteration = 0;
                        drawingFlippyRun = false;
                        flippyRunCTX.clearRect(0, 0, screenWidth, screenHeight);
                    }
                }
                
               
                if (i == 4) {
                    // flippy room
                    for (let i=0; i<animatronicImages.length; i++) {animatronicImages[i].style.display = "none";}
                    cameraImage.src = "./Cameras/C4A" + entities["FlippyDoo"]["CurrentStage"] + ".png";

                } else {
                    cameraImage.src = "./Cameras/" + cameraImages[currentCameraNum]; // cameraImages[cameras[i]].textContent;
                
                    // DRAW ENTITIES
                    drawEntities();
                    /*
                    if (curAnimatronicImgs.length > 0) {
                        for (let i=0; i<curAnimatronicImgs.length; i++) {
                            curAnimatronicImgs[i].remove();
                        }
                    }
                    for (let i=0; i<Object.keys(entities).length; i++) {
                    
                        if (Object.values(entities)[0]["Location"] == currentCameraNum) {
                            let img = document.createElement("img");
                            img.classList.add("animatronicImage");
                            img.src = "./Animatronics/" + Object.keys[i] + "/" + currentCameraNum + ".png";

                            curAnimatronicImgs.push(img);
                            document.body.appendChild(img);
                        }
                                    
                    }
                    */
                }
            });
        }
        //ASDFJKL
        /*
        for (let i=0; i<10; i++) {
            alert(soundEffectsDir["Random"][Math.floor(Math.random()*soundEffectsDir["Random"].length)]);
        }
        */
        function randomSounds() {
            playAudio(soundEffectsDir["Random"][Math.floor(Math.random()*soundEffectsDir["Random"].length)]);
            randomSoundsTimeout = setTimeout(randomSounds, 5000 + (Math.floor(Math.random()*120)*1000));
        }
        function creepySpudHallucinate() {
            cancelAllAudio();

            const hImg = document.createElement("img");
            hImg.style.position = "absolute";
            hImg.style.width = "100%"; hImg.style.height = "100%";
            hImg.style.top = "0"; hImg.style.left = "0";
            hImg.src = "./Animatronics/Hallucination.png";
            hImg.style.zIndex = 1000;
            document.body.appendChild(hImg);
            playAudio("trimmednightmarespudjumpscare.mp3");

            setTimeout(function() {
                window.close();
            }, 4000);
        }

        
        const startScreen = document.getElementById("startScreen");
        const startScreenNight = document.getElementById("startScreenNight");
        const nightList = ["1st", "2nd", "3rd", "4th", "5th", "6th", "7th"];
        function startGame() {

            canvasOverlayCTX.clearRect(0, 0, canvasOverlay.width, canvasOverlay.height);
            canvasOverlay.style.display = "flex";
            runningStatic = true;
            staticEffect();

            setTimeout(function() {
                runningStatic = false;
                canvasOverlayCTX.fillStyle = "black";
                canvasOverlayCTX.fillRect(0, 0, screenWidth, screenHeight);
                canvasOverlay.style.display = "none";

                startScreen.style.opacity = "100%";
                startScreen.style.display = "block";
                startScreenNight.textContent = nightList[nightPlaying] + " Night";
                playAudio("nightstart.mp3");
                
                setTimeout(function() {

                    startScreen.style.opacity = 0;
                    setTimeout(function() {
                        startScreen.style.display = "none";
                    }, 1000);

                    fanAudio.play();

                    gameplayMusic.currentTime = 0;
                    gameplayMusic.play();
                    fan.src = "./fan.png";
                    flippysSongId = setInterval(flippysSong, 4000);
                    entities["FlippyDoo"]["CurrentStage"] = 0;
                    
                    for (let name in allAudio) {
                        allAudio[name]
                    }

                    gameStarted = true;
                    powerOut = false;

                    timesFoxyBlocked = 0;

                    
                    currentNightP.textContent = "Night " + (parseInt(nightPlaying)+1);

                    gameOverScreen.style.display = "none";
                    RealMenu.style.display = "none";
                    mainMenu.style.display = "none";
                    canvasOverlay.style.display = "none";

                    mainGame.style.opacity = "100%";
                    mainGame.style.display = "flex";

                    mainRoom.style.filter = "";

                    // RESET ALL VARIABLES IF SECOND TRY AT NIGHT
                    camCheckedForFlippy = false;
                    mainRoomPosition = -50;
                    //mainRoom.style.transform = "translate(-50vw)";

                    moved = false;
                    cameraOnScreen = false;
                    currentCameraNum = "C6";
                    cameraImage.src = "./Cameras/C6.png";
                    battery = 100.00;

                    powerLevel.textContent = "100%";
                    timeText.textContent = "12 AM";
                    time = 0;

                    resetButtons();

                    batteryUsage = 1;
                    updateBatteryLoss(0);

                    iteration = 0;
                    staticDuration = 10;
                    fpsCount = 0;
                    lastBattery = battery;
                    
                    
                    if (nightPlaying > 0) {
                        if (nightPlaying < 4) {
                            passiveDrainInterval = setInterval(passiveDrain, (8-nightPlaying)*1000);
                        } else {
                            passiveDrainInterval = setInterval(passiveDrain, 3000);
                        }
                    }
                    

                    // START MOVEMENT LOOP FOR ALL ENTITIES
                    for (let i=0; i<Object.keys(entities).length; i++) {
                        let entity = Object.values(entities)[i];
                        entity["Location"] = entity["StartLocation"];
                        if (nightPlaying == 6) {
                            entity["Agro"] = customAgro[i];
                        } else {
                            entity["Agro"] = agroPerNight[entity["Name"]][nightPlaying];
                        }
                        //if (entity["Agro"] > 0) {
                            const settedTimeouted = setTimeout(moveEntity, entity["MoveTime"]*1000, entity);
                            allTimeouts[entity["Name"]] = settedTimeouted;
                            /*
                            let timeout = maxWaitTime / (entity["Agro"] * ((Math.random()) * 3));
                            if (cameraRelativity[entity["Location"]].includes("Room")) {
                                if (Math.floor(Math.random() * 8) == 1) {
                                    if (entity["Attack"] == "Wait") {

                                    } else if (entity["Attack"] == "Time") {
                                        //setTimeout();
                                    } else if (entity["Attack"] == "Instant") {

                                    }
                                }
                            } else {
                                let settedTimeouted = setTimeout(moveEntity, timeout, entity);
                                allTimeouts.push(settedTimeouted);
                            }
                            */
                        //}
                    }

                    tick();
                    currentUpdateFPSTimeout = setTimeout(updateFPS, 1000);
                    currentAddHourTimeout = setTimeout(addHour, 90000);

                    randomSoundsTimeout = setTimeout(randomSounds, 5000 + (Math.floor(Math.random()*120)*1000));
                    // NOT SURE IF THERE EVEN NEEDS TO BE A TIMEOUT
                    if (nightPlaying < 5) {
                        setTimeout(function() {
                            // technically never possible to have gameStarted be false in real game, but for testing
                            if (gameStarted && !powerOut) {
                                playAudio("phone" + nightPlaying + ".wav");
                            }
                        }, 5000);
                    }
                }, 4000);
            }, 500);
        }

        /*
        FNAF SONG 9.2 SECONDS IN: 
        -2.35 second black screen: 6.85 s
        -4.5 second presents: 2.35s
        -2.35 second black screen: 0 s
        */
        // UNBIND THIS FUNCTION AFTER KEYDOWN
        
        
        document.addEventListener("keydown", function() {
            if (!introAnimationStarted) {
                glowyText.style.opacity = "0";

                menuMusic.play();
                setTimeout(function() {
                    //glowyText.textContent = "Adjust audio until you hear whispering...";
                    //glowyText.style.opacity = "100%";

                    glowyText.textContent = "Satraj Presents...";
                    glowyText.style.opacity = "100%";
                    setTimeout(function() {

                        glowyText.style.opacity = "0";
                        setTimeout(function() {
                            menuMusic.pause();
                            menuMusic2.play();
                            RealMenu.style.display = "block";
                        }, 2400);
                    }, 4500);
                }, 2400);
                introAnimationStarted = true;
            }
        });
        
        
        startBtn.addEventListener("click", function() {
            
            nightSelection.style.opacity = 0;
            nightSelection.style.display = "flex";
            /*
            title.style.opacity = 0;
            startBtn.style.opacity = 0;
            */
            titleScreen.style.opacity = 0;
            drawingTSStatic = false;


            setTimeout(function() {
                nightSelection.style.opacity = "100%";
            }, 1000);
        });


        const newGameConfirmation = document.getElementById("newGameConfirmation");
        let showingConfirmation = false;
        document.getElementById("newGameBtn").addEventListener("click", function() {
            if (showingConfirmation) {
                newGameConfirmation.style.transform = "";
                setTimeout(function() {newGameConfirmation.style.display = "";}, 1000);
            } else {
                newGameConfirmation.style.display = "flex";
                newGameConfirmation.style.transform = "translate(0, 0)";
            }
            showingConfirmation = !showingConfirmation;
        });
        document.getElementById("newGameBackBtn").addEventListener("click", function() {
            newGameConfirmation.style.transform = "";
            showingConfirmation = false;
        });
        document.getElementById("newGameConfirmationBtn").addEventListener("click", function() {
            currentNight = 0;
            updateNight(0);
            newGameConfirmation.style.transform = "";
            setTimeout(function() {newGameConfirmation.style.display = "";}, 1000);
            showingConfirmation = false;
        });


        // SINT
        /*
        glowyText.style.opacity = "0";
        RealMenu.style.display = "block";
        introAnimationStarted = true;
        //startBtn.click();
        //*/
        


        if (cheatsEnabled) {
            document.addEventListener("keydown", function() {
                if (event.key == "3") {
                    drawingFlippyRun = true;
                }
            });
            let inputVisible = true;
            let input = document.createElement("input");
            input.style.zIndex = 1000;
            input.style.position = "absolute";
            input.style.backgroundColor = "white";
            input.style.opacity = "0";
            input.addEventListener("keydown", function(event) {
                if (event.key == "Enter") {
                    let value = input.value;
                    if (value.startsWith("cmd")) {
                        value = value.slice(4);
                        if (value.startsWith("jumpscare")) {
                            let anim = value.slice(10);
                            if (anim == "FlippyRun") {
                                drawingFlippyRun = true;
                                /*
                                canvasOverlayCTX.clearRect(0, 0, canvasOverlay.width, canvasOverlay.height);
                                canvasOverlay.style.display = "flex";
                                animationList = jumpscareImages["FlippyRun"];
                                animationFrame = 0;
                                window.requestAnimationFrame(renderAnimation);
                                */
                            } else if (Object.keys(entities).includes(anim)) {
                                jumpscare(anim);
                            } else {
                                alert("Entity Not Found");
                            }
                        } else if (value.startsWith("powerout")) {
                            battery = .1;
                        } else if (value.startsWith("setNight")) {
                            value = value.slice(9);
                            if (0 <= value <= 6) {
                                /*
                                while (currentNight != (value-1)) {
                                    if (currentNight > value) {currentNight -= 1} else {currentNight++};
                                }
                                */
                                currentNight = value-1;
                                updateNight(currentNight);
                            }
                        } else if (value.startsWith("victory")) {
                            victory();
                        } else if (value.startsWith("flippyStage++")) {
                            entities["FlippyDoo"]["CurrentStage"]++;
                        } else if (value.startsWith("maxStage")) {
                            entities["FlippyDoo"]["CurrentStage"] = 4;
                        } else if (value.startsWith("entLoc")) {
                            for (let name in entities) {
                                alert(name + ", " + entities[name]["Location"]);
                            }
                        } else if (value.startsWith("setLoc")) {
                            value = value.slice(7);
                            let curAnim;
                            for (let anim in entities) {
                                if (value.startsWith(anim)) {
                                    curAnim = anim;
                                    break;
                                }
                            }
                            if (curAnim) {
                                if (Object.keys(cameraRelativity).includes(value.slice(curAnim.length+1))) {
                                    entities[curAnim]["Location"] = value.slice(curAnim.length);
                                } else {
                                    alert("Location not found");
                                }
                            } else {
                                alert("Animatronic not found");
                            }
                        } else {
                            alert("Unknown command.");
                        }
                    }
                    input.value = "";
                }
            });
            document.addEventListener("keydown", function(event) {
                if (event.key == "@") {
                    event.preventDefault();
                    inputVisible = !inputVisible;
                    if (inputVisible) {
                        input.blur();
                        input.value = "";
                    } else {
                        input.focus();
                    }
                }
            });
            document.body.appendChild(input);
        }

        /*
        document.addEventListener("keydown", function(event) {
            if (event.key == "1") {
                jumpscare("KingSpud");
            } else if (event.key == "2") {
                victory();
            } else if (event.key == "3") {
                battery = .1;
            } else if (event.key == "4") {
                currentNight -= 1;
                //alert(currentNight);
                updateNight(currentNight);
            } else if (event.key == "5") {
                currentNight = parseInt(currentNight)+1;
                //alert(currentNight);
                updateNight(currentNight);
            } else if (event.key == "6") {
                entities["FlippyDoo"]["CurrentStage"]++;
            } else if (event.key == "7") {
                jumpscare("KingSpud");
            }
        })
        */
        //AI: left side: the sampler, right side: pair programmers, camera checker: flippy doo, random: unit 4 test.

        document.addEventListener("visibilitychange", function() {
            if (document.hidden) {
                if (gameStarted) {
                    jumpscare("Left the Game (cannot switch tabs due to performance issues on Chrome).");
                }
            } else {
            }
        });

        const allCanvases = [canvasOverlay, titleScreenStatic, static, flippyRunCanvas];
        function resizeWindow() {
            //info.textContent = `${window.innerWidth} + ${window.innerHeight}`
            screenWidth = window.innerWidth;
            screenOffsetX = screenWidth / 10;
            screenHeight = window.innerHeight;
            screenOffsetY = screenWidth / 15;

            rowSize = screenWidth/staticRows;
            columnSize = screenHeight/staticColumns;

            allCanvases.forEach(a => {
                a.width = screenWidth;
                a.height = screenHeight;
            });
        }
        resizeWindow();
        window.addEventListener("resize", resizeWindow);


        } catch (er) {
            alert(er);
        }
    </script>
</body>
</html>
